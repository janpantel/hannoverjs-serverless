service: hjs-serverless

provider:
  name: aws
  runtime: nodejs4.3
  stage: dev
  region: eu-west-1

package:
    exclude:
        - "node_modules/**"
        - "!node_modules/uuid/**"

functions:
  createMeetup:
    handler: handler.createMeetup
    events:
        - http:
            path: meetup
            method: post
  getAllMeetups:
    handler: handler.getAllMeetups
    events:
        - http:
            path: meetup
            method: get
  getMeetupById:
    handler: handler.getMeetupById
    events:
        - http:
            path: meetup/{id}
            method: get

resources:
    Resources:
        MeetupsTable:
          Type: AWS::DynamoDB::Table
          Properties:
            TableName: meetups
            AttributeDefinitions:
              - AttributeName: id
                AttributeType: S
            KeySchema:
              - AttributeName: id
                KeyType: HASH
            ProvisionedThroughput:
              ReadCapacityUnits: 1
              WriteCapacityUnits: 1
        MeetupsTableIAMPolicy:
          Type: AWS::IAM::Policy
          DependsOn: MeetupsTable
          Properties:
            PolicyName: meetups-table-lambda-dynamodb
            PolicyDocument:
              Version: '2012-10-17'
              Statement:
                - Effect: Allow
                  Action:
                    - dynamodb:GetItem
                    - dynamodb:PutItem
                    - dynamodb:Scan
                  Resource: arn:aws:dynamodb:*:*:table/meetups
            Roles:
                - Ref: IamRoleLambdaExecution
